{"version":3,"file":"backend.js","sourceRoot":"","sources":["../../src/js/backend.ts"],"names":[],"mappings":"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","sourcesContent":["import { BrowserBackend } from \"@sentry/browser/dist/backend\";\nimport { BaseBackend, NoopTransport } from \"@sentry/core\";\nimport { BrowserOptions, Transports } from \"@sentry/react\";\nimport { Event, EventHint, Severity, Transport } from \"@sentry/types\";\n// @ts-ignore LogBox introduced in RN 0.63\nimport { Alert, LogBox, YellowBox } from \"react-native\";\n\nimport { ReactNativeOptions } from \"./options\";\nimport { NativeTransport } from \"./transports/native\";\nimport { NATIVE } from \"./wrapper\";\n\n/** The Sentry ReactNative SDK Backend. */\nexport class ReactNativeBackend extends BaseBackend<BrowserOptions> {\n  private readonly _browserBackend: BrowserBackend;\n\n  /** Creates a new ReactNative backend instance. */\n  public constructor(protected readonly _options: ReactNativeOptions) {\n    super(_options);\n    this._browserBackend = new BrowserBackend(_options);\n\n    // This is a workaround for now using fetch on RN, this is a known issue in react-native and only generates a warning\n    // YellowBox deprecated and replaced with with LogBox in RN 0.63\n    if (LogBox) {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n      LogBox.ignoreLogs([\"Require cycle:\"]);\n    } else {\n      // eslint-disable-next-line deprecation/deprecation\n      YellowBox.ignoreWarnings([\"Require cycle:\"]);\n    }\n\n    void this._startWithOptions();\n  }\n\n  /**\n   * If native client is available it will trigger a native crash.\n   * Use this only for testing purposes.\n   */\n  public nativeCrash(): void {\n    if (this._options.enableNative) {\n      NATIVE.crash();\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n  public eventFromException(\n    exception: unknown,\n    hint?: EventHint\n  ): PromiseLike<Event> {\n    return this._browserBackend.eventFromException(exception, hint);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  public eventFromMessage(\n    message: string,\n    level: Severity = Severity.Info,\n    hint?: EventHint\n  ): PromiseLike<Event> {\n    return this._browserBackend.eventFromMessage(message, level, hint);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  protected _setupTransport(): Transport {\n    if (!this._options.dsn) {\n      // We return the noop transport here in case there is no Dsn.\n      return new NoopTransport();\n    }\n\n    const transportOptions = {\n      ...this._options.transportOptions,\n      dsn: this._options.dsn,\n    };\n\n    if (this._options.transport) {\n      return new this._options.transport(transportOptions);\n    }\n\n    if (this._isNativeTransportAvailable()) {\n      return new NativeTransport();\n    }\n\n    return new Transports.FetchTransport(transportOptions);\n  }\n\n  /**\n   * If true, native client is availabe and active\n   */\n  private _isNativeTransportAvailable(): boolean {\n    return (\n      this._options.enableNative === true &&\n      NATIVE.isNativeClientAvailable() &&\n      NATIVE.isNativeTransportAvailable()\n    );\n  }\n\n  /**\n   * Starts native client with dsn and options\n   */\n  private async _startWithOptions(): Promise<void> {\n    let didCallNativeInit = false;\n\n    try {\n      didCallNativeInit = await NATIVE.startWithOptions(this._options);\n      NATIVE.setLogLevel(this._options.debug ? 2 : 1);\n    } catch (_) {\n      this._showCannotConnectDialog();\n\n      this._options.onReady?.({ didCallNativeInit: false });\n\n      return;\n    }\n\n    this._options.onReady?.({ didCallNativeInit });\n  }\n\n  /**\n   * If the user is in development mode, and the native nagger is enabled then it will show an alert.\n   */\n  private _showCannotConnectDialog(): void {\n    if (__DEV__ && this._options.enableNativeNagger) {\n      Alert.alert(\n        \"Sentry\",\n        \"Warning, could not connect to Sentry native SDK.\\nIf you do not want to use the native component please pass `enableNative: false` in the options.\\nVisit: https://docs.sentry.io/platforms/react-native/#linking for more details.\"\n      );\n    }\n  }\n}\n"]}