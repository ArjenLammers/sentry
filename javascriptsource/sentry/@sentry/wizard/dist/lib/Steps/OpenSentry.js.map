{"version":3,"file":"OpenSentry.js","sourceRoot":"","sources":["../../../lib/Steps/OpenSentry.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,iDAAgD;AAChD,6CAA2D;AAC3D,2CAAyD;AACzD,uCAAsC;AACtC,IAAM,GAAG,GAAG,OAAO,CAAC,KAAK,CAAC,CAAC;AAC3B,IAAM,EAAE,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC;AAEzB;IAAgC,8BAAQ;IAAxC;;IAwCA,CAAC;IAvCc,yBAAI,GAAjB,UAAkB,OAAgB;;;;;4BAC3B,qBAAM,8BAAqB,CAAC,OAAO,CAAC,CAAC,UAAU,CAAC,OAAO,CAAC,EAAA;;wBAA7D,IAAI,CAAC,CAAA,SAAwD,CAAA,EAAE;4BAC7D,aAAG,CAAC,yDAAyD,CAAC,CAAC;4BAC/D,sBAAO,EAAE,EAAC;yBACX;wBACD,IAAI,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE;4BACzB,aAAG,CAAC,+BAA+B,CAAC,CAAC;4BACrC,sBAAO,EAAE,EAAC;yBACX;wBAEK,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC;wBAE9B,qBAAS,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC;wBACpC,IAAI,CAAC,KAAK,CAAC,wBAAsB,OAAS,CAAC,CAAC;;;;wBAG7B,qBAAM,EAAE,CAAC,GAAG,CAAI,OAAO,kBAAe,CAAC,CAAC,IAAI,EAAA;;wBAAnD,IAAI,GAAG,SAA4C;wBAEzD,qBAAS,CAAC,IAAI,EAAE,CAAC;wBAEX,SAAS,GAAM,OAAO,gCAA2B,IAAI,CAAC,IAAI,MAAG,CAAC;wBAEpE,GAAG,CAAC,SAAS,CAAC,CAAC;wBACf,YAAE,EAAE,CAAC;wBACL,WAAC,CAAC,aAAa,CAAC,CAAC;wBACjB,eAAK,CAAC,SAAS,CAAC,CAAC;wBACjB,WAAC,CAAC,4CAA4C,CAAC,CAAC;wBAChD,YAAE,EAAE,CAAC;wBAEL,sBAAO,EAAE,IAAI,EAAE,IAAI,CAAC,IAAI,EAAE,EAAC;;;wBAE3B,IAAI,CAAC,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;wBAC7B,qBAAS,CAAC,IAAI,EAAE,CAAC;wBACjB,YAAE,EAAE,CAAC;wBACL,aAAG,CAAC,gCAA8B,OAAO,mCAAgC,CAAC,CAAC;wBAC3E,WAAC,CAAC,0EAA0E,CAAC,CAAC;wBAC9E,sBAAO,EAAE,EAAC;;;;;KAEb;IACH,iBAAC;AAAD,CAAC,AAxCD,CAAgC,mBAAQ,GAwCvC;AAxCY,gCAAU","sourcesContent":["import { Answers } from 'inquirer';\nimport * as _ from 'lodash';\nimport { BottomBar } from '../Helper/BottomBar';\nimport { dim, green, l, nl, red } from '../Helper/Logging';\nimport { getCurrentIntegration } from '../Helper/Wizard';\nimport { BaseStep } from './BaseStep';\nconst opn = require('opn');\nconst r2 = require('r2');\n\nexport class OpenSentry extends BaseStep {\n  public async emit(answers: Answers): Promise<Answers> {\n    if (!await getCurrentIntegration(answers).shouldEmit(answers)) {\n      dim('Skipping connection to Sentry due files already patched');\n      return {};\n    }\n    if (this.argv.skipConnect) {\n      dim('Skipping connection to Sentry');\n      return {};\n    }\n\n    const baseUrl = this.argv.url;\n\n    BottomBar.show('Loading wizard...');\n    this.debug(`Loading wizard for ${baseUrl}`);\n\n    try {\n      const data = await r2.get(`${baseUrl}api/0/wizard/`).json;\n\n      BottomBar.hide();\n\n      const urlToOpen = `${baseUrl}account/settings/wizard/${data.hash}/`;\n\n      opn(urlToOpen);\n      nl();\n      l('Please open');\n      green(urlToOpen);\n      l(\"in your browser (if it's not open already)\");\n      nl();\n\n      return { hash: data.hash };\n    } catch (e) {\n      this.argv.skipConnect = true;\n      BottomBar.hide();\n      nl();\n      red(`Wizard couldn't connect to ${baseUrl}\\nmake sure the url is correct`);\n      l('But no worries, we fall back to asking you stuff instead, so here we go:');\n      return {};\n    }\n  }\n}\n"]}