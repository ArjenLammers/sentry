{"version":3,"file":"transaction.min.js","sources":["../src/transaction.ts"],"sourcesContent":["import { Event, EventProcessor, Hub, Integration, StackFrame } from '@sentry/types';\n\n/** Add node transaction to the event */\nexport class Transaction implements Integration {\n  /**\n   * @inheritDoc\n   */\n  public static id: string = 'Transaction';\n\n  /**\n   * @inheritDoc\n   */\n  public name: string = Transaction.id;\n\n  /**\n   * @inheritDoc\n   */\n  public setupOnce(addGlobalEventProcessor: (callback: EventProcessor) => void, getCurrentHub: () => Hub): void {\n    addGlobalEventProcessor(event => {\n      const self = getCurrentHub().getIntegration(Transaction);\n      if (self) {\n        return self.process(event);\n      }\n      return event;\n    });\n  }\n\n  /**\n   * @inheritDoc\n   */\n  public process(event: Event): Event {\n    const frames = this._getFramesFromEvent(event);\n\n    // use for loop so we don't have to reverse whole frames array\n    for (let i = frames.length - 1; i >= 0; i--) {\n      const frame = frames[i];\n\n      if (frame.in_app === true) {\n        event.transaction = this._getTransaction(frame);\n        break;\n      }\n    }\n\n    return event;\n  }\n\n  /** JSDoc */\n  private _getFramesFromEvent(event: Event): StackFrame[] {\n    const exception = event.exception && event.exception.values && event.exception.values[0];\n    return (exception && exception.stacktrace && exception.stacktrace.frames) || [];\n  }\n\n  /** JSDoc */\n  private _getTransaction(frame: StackFrame): string {\n    return frame.module || frame.function ? `${frame.module || '?'}/${frame.function || '?'}` : '<unknown>';\n  }\n}\n"],"names":["this","Transaction","id","addGlobalEventProcessor","getCurrentHub","event","self","getIntegration","process","frames","_getFramesFromEvent","i","length","frame","in_app","transaction","_getTransaction","exception","values","stacktrace","module","function"],"mappings":"wFAGA,aASSA,UAAeC,EAAYC,GA4CpC,OAvCSD,sBAAP,SAAiBE,EAA6DC,GAC5ED,EAAwB,SAAAE,GACtB,IAAMC,EAAOF,IAAgBG,eAAeN,GAC5C,OAAIK,EACKA,EAAKE,QAAQH,GAEfA,KAOJJ,oBAAP,SAAeI,GAIb,IAHA,IAAMI,EAAST,KAAKU,oBAAoBL,GAG/BM,EAAIF,EAAOG,OAAS,EAAGD,GAAK,EAAGA,IAAK,CAC3C,IAAME,EAAQJ,EAAOE,GAErB,IAAqB,IAAjBE,EAAMC,OAAiB,CACzBT,EAAMU,YAAcf,KAAKgB,gBAAgBH,GACzC,OAIJ,OAAOR,GAIDJ,gCAAR,SAA4BI,GAC1B,IAAMY,EAAYZ,EAAMY,WAAaZ,EAAMY,UAAUC,QAAUb,EAAMY,UAAUC,OAAO,GACtF,OAAQD,GAAaA,EAAUE,YAAcF,EAAUE,WAAWV,QAAW,IAIvER,4BAAR,SAAwBY,GACtB,OAAOA,EAAMO,QAAUP,EAAMQ,UAAcR,EAAMO,QAAU,UAAOP,EAAMQ,UAAY,KAAQ,aA/ChFpB,KAAa"}